{% extends "large_container.html" %}

{% load feedback_tags %}
{% load permission_tags %}
{% load thumbnail %}
{% load widget_tweaks %}

{% block title %}
Feedback - {{ applicant.get_full_name }}
{% endblock %}

{% block inner_content %}

<div class="row">
  <div class="col-md-12 text-center">
    <h4 class="margin-bot-md">
      {% if applicant.gender == 'Male' %}
      Mr.
      {% elif applicant.gender == 'Female' %}
      Ms.
      {% endif %}
      {{ applicant.get_full_name }}
      {% if user|has_role:'staff' %}
        <a href="{% url 'feedback:edit_applicant' applicant.norm_name %}" class="btn btn-default btn-sm profile-show-btn"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>&nbsp;&nbsp;Edit</a>
      {% endif %}
    </h4>
  </div>
  <div class="col-md-6">
    <div class="text-center">
      {% thumbnail applicant.pic "200x250" crop="center" as im %}
        <img src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}">
      {% endthumbnail %}
      <br>
      <br>
      {% if applicant.high_school %}
        <h5>{{ applicant.high_school }}</h5>
      {% endif %}
      {% if applicant.hometown or applicant.hometown_state %}
        <h5>
          {% if applicant.hometown %}
          {{ applicant.hometown }}{% endif %}{% if applicant.hometown and applicant.hometown_state %},{% endif %}
          {% if applicant.hometown_state %}
          {{ applicant.hometown_state }}
          {% endif %}
        </h5>
      {% endif %}
      {% if user|has_role:'staff' %}
        <table class="table table-striped table-hover margin-top-lg">
          <tbody>
            <tr>
              <td>Rating average:</td>
              <td>{{ feedback|rating_average }}</td>
            </tr>
            <tr>
              <td>Interest average:</td>
              <td>{{ feedback|interest_average }}</td>
            </tr>
            <tr>
              <td># of feedback:</td>
              <td>{{ feedback|feedback_count }}</td>
            </tr>
          </tbody>
        </table>
      {% endif %}
    </div>
  </div>
  <div class="col-md-6">
    <div class="row">
      <form method="post" action="">
        {% csrf_token %}
        {% if form.errors %}
          There were errors!
        {% endif %}
        <div class="col-md-12">
          <div class="form-group">
            <label for="id_rating" class="form-label">
              Is this person a Scholar?
            </label>
            {{ form.rating }}
            <span class="error">{{ form.rating.errors }}</span>
          </div>
        </div>
        <div class="col-md-12">
          <div class="form-group">
            <label for="id_interest" class="form-label">
              Does this person want to be a Scholar?
            </label>
            {{ form.interest|add_class:"form-control" }}
            <span class="error">{{ form.interest.errors }}</span>
          </div>
        </div>
        <div class="col-md-12">
          <div class="form-group">
            <label for="id_comments" class="form-label">
              Additional comments (especially about personality, soft skills):
            </label>
            {{ form.comments|add_class:"form-control" }}
            <span class="error">{{ form.comments.errors }}</span>
          </div>
        </div>
        <br>
        <div class="col-md-12 text-center">
          <a href="{% url 'feedback:index' %}" class="btn btn-default">BACK</a>
          &nbsp;&nbsp;
          <input class="btn btn-default" type="submit" value="SAVE" />
        </div>
        <br>
      </form>
    </div>
  </div>
  {% if user|has_role:'staff' %}
    <div class="col-md-12">
      <h4>Feedback</h4>
        <table class="table table-striped table-hover margin-top-lg">
          <thead>
            <tr>
              <th>Scholar</th>
              <th>Rating</th>
              <th>Interest</th>
              <th>Comments</th>
            </tr>
          </thead>
          <tbody>
            {% for f in feedback %}
              {% if f.rating or f.interest or f.comments %}
                  <tr>
                    <td><a href="{% url 'profile' f.scholar.norm_name %}">{{ f.scholar.get_full_name }}</a></td>
                    <td>{% if f.rating %}{{ f.rating }}{% endif %}</td>
                    <td>{% if f.interest %}{{ f.interest }}{% endif %}</td>
                    <td>{{ f.comments }}</td>
                  </tr>
              {% endif %}
            {% endfor %}
          </tbody>
        </table>
    </div>
  {% endif %}
</div>

{% endblock %}
